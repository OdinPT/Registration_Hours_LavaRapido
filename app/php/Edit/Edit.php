<?phpinclude "../config.php";include "../Functions.php";//error_reporting(0);$mysqli->set_charset("utf8");$DataAtual=date("Y-m-d");$id11 = $_COOKIE['cookieID_EF'];$idEmp11 = $_POST['IDEmpresa3'];$id11 = mysqli_real_escape_string($mysqli, $id11);$idEmp11 = mysqli_real_escape_string($mysqli, $idEmp11);$id12 = $_COOKIE['cookieID_funcionario'];$user12 = $_POST['username02'];$passe12 = $_POST['pass02'];$NIFF12 = $_POST['NIFF_funcionario'];$TF12 = $_POST['TFx'];$login12= $_POST['login'];$id12 = mysqli_real_escape_string($mysqli, $id12);$user12 = mysqli_real_escape_string($mysqli, $user12);$passe12 = mysqli_real_escape_string($mysqli, $passe12);$NIFF12 = mysqli_real_escape_string($mysqli, $NIFF12);$TF12 = mysqli_real_escape_string($mysqli, $TF12);$login12 = mysqli_real_escape_string($mysqli, $login12);$IniciarSessao12 = $_POST['Ccookie_funcionario'];$ID_Tol12 =$_POST['ID_Toleranciax'];$IniciarSessao12 = mysqli_real_escape_string($mysqli, $IniciarSessao12);$ID_Tol12 = mysqli_real_escape_string($mysqli, $ID_Tol12);$id14 = $_COOKIE['cookieID_Local'];$CP14 = $_POST['CodigoPostal'];$NomeLocal14= $_POST['NomeLocal'];$id14 = mysqli_real_escape_string($mysqli, $id14);$CP14 = mysqli_real_escape_string($mysqli, $CP14);$NomeLocal14 = mysqli_real_escape_string($mysqli, $NomeLocal14);$user15 = $_POST['usernamee'];$NomeLocal15 = $_POST['Locaiss'];$user15 = mysqli_real_escape_string($mysqli, $user15);$NomeLocal15 = mysqli_real_escape_string($mysqli, $NomeLocal15);$id16 = $_COOKIE['cookieID_RegHoras'];$id616 =  $_POST['ID_Reg_horas'];$tipo_regg16 = $_POST['Descricao_tipo_regg'];$user= $_POST['usernamee'];$Descricao_Locall16 = $_POST['Descricao_Localll'];$Hora_entradaManha_rhh16 = $_POST['Hora_entradaManha_rhh'];$id16 = mysqli_real_escape_string($mysqli, $id16);$id616 = mysqli_real_escape_string($mysqli, $id616);$tipo_regg16 = mysqli_real_escape_string($mysqli, $tipo_regg16);$user = mysqli_real_escape_string($mysqli, $user);$Descricao_Locall16 = mysqli_real_escape_string($mysqli, $Descricao_Locall16);$out0 = FormataDatabarra($Hora_entradaManha_rhh16);$id17 = $_COOKIE['cookieID_empresaSelect'];$nome17 = $_POST['Nome_empresa'];$NIFF17 = $_POST['Niff_empresa'];$nome17 = mysqli_real_escape_string($mysqli, $nome17);$NIFF17 = mysqli_real_escape_string($mysqli, $NIFF17);$username = $_COOKIE['cookieEmail'];$Dataz = $_POST['Dataz'];$DataEdit = $Dataz;$Dataz = mysqli_real_escape_string($mysqli, $Dataz);$Action = $_POST['Tipo_validacao'];      // dia atual formatado$DataAtualFormatada = FormataDataInversa($DataEdit);      //dia anterior$DiaAnterior = RetornaDiaAnt_DataPers($DataEdit);$diaAntFormatado= FormataDataInversa($DiaAnterior);      //dia seguinte$diaSeguinte = RetornaDiaDep_DataPers($DataEdit);$diaDepFormatado = FormataDataInversa($diaSeguinte);//Retorna Limite diario dos equipamentos$query = mysqli_query($mysqli, "SELECT `ID_LimMaxCont`,`Limit_Diario`,Tipo_Equip_LimMaxCont,`ID_Local_LimMaxCont` as ID_Local                                        FROM Lim_Max_Cont                                        where `ID_Local_LimMaxCont` = '$local19' and Tipo_Equip_LimMaxCont ='$TipoEquip19'");   while($res = mysqli_fetch_array($query)) {	        $LimMaxDiario = $res['Limit_Diario'];	        $TipoEquipamento = $res['Tipo_Equip_LimMaxCont'];   }    //dia anterior a contagem$query1 = mysqli_query($mysqli, "SELECT * FROM `Postos_Pistas`,Reg_Equipamentos_Lavagem                                 where  ID_EquiPorLav_PP =ID_EquiLav and `DataPP` = '$diaAntFormatado'                                 and ID_Tipo_equiLav = '$TipoEquipamento' order by`DataPP` desc limit 1");   while($res = mysqli_fetch_array($query1)) {	        $LastCongemFunc = $res['ContagemPP'];            $ID_PPistas2 = $res['ID_PPistas'];            $ID_TipoPP2 = $res['ID_Tipo_equiLav'];            $Num_EquiLav = $res['Num_EquiLav'];    }    //Retorna Contagem do dia anterior ao da edição$query3 = mysqli_query($mysqli, "SELECT *                                 FROM `Postos_Pistas` WHERE `ID_Func_PP` = RetornaIdFuncionario('$username')                                    and `DataPP`= '$diaAntFormatado' and ID_TipoPP = '$TipoEquipamento'                                    order by`DataPP` desc limit 1");   while($res = mysqli_fetch_array($query3)){	        $ID_PPistas2 = $res['ID_PPistas'];	        $ID_TipoPP2 = $res['ID_TipoPP'];	        $BeforeDataPP = $res['DataPP'];   }    //Retorna Contagem dia Seguinte$query4 = mysqli_query($mysqli, "SELECT * FROM `Postos_Pistas`,Reg_Equipamentos_Lavagem                                                                   where  ID_EquiPorLav_PP =ID_EquiLav                                                                            and `DataPP` = '$diaDepFormatado'                                                                             and ID_Tipo_equiLav = '$TipoEquipamento'                                                                             order by`DataPP` desc limit 1");   while($res = mysqli_fetch_array($query4)) {	        $BeforeCongemFunc = $res['ContagemPP'];	        $BeforeDataPPx = $res['DataPP'];	        $ID_PPistasSeg = $res['ID_PPistas'];            $ID_TipoPPSeg = $res['ID_Tipo_equiLav'];   }    $limiteDicao = $LastCongemFunc + $LimMaxDiario;if ($Action == 1.1) { $insere = mysqli_query($mysqli, "call EditaFuncEmp('$id11','$idEmp11')");} if ($Action == 1.2) { $insere = mysqli_query($mysqli, "call EditaFuncionarios('$id12','$user12','$passe12','$NIFF12','$TF12','$login12','$IniciarSessao12','$ID_Tol12')");}if ($Action == 1.4) {  $insere = mysqli_query($mysqli, "call EditaLocal('$NomeLocal14','$CP14','$id14')");} if ($Action == 1.5) { $insere = mysqli_query($mysqli, "call EditaLocaisLF('$user15','$NomeLocal15','$idLocal')");} if ($Action == 1.6) {            // problema ta na conversão da data 23/09/2018 16:20   $insere = mysqli_query($mysqli, "call EditaRegHoras('$id16','$tipo_regg16','$Descricao_Locall16','$out0','$user')");} if ($Action == 1.7) {    $insere = mysqli_query($mysqli, "call EditaEmpresa('$id17','$nome17','$NIFF17')");} if ($Action == 1.9) {        if ( ($Contador19 > $LastCongemFunc) && ( $BeforeCongemFunc > $Contador19 ) ) {            if($Contador19<= $limiteDicao){                $insere = mysqli_query($mysqli, "call EditaRegContdiario('$TipoEquip19','$local19','$Contador19',                                                                            '$id19','$DataAtualFormatada')");                } else{                        header("HTTP/1.0 406 Not Found");                        header('HTTP', true, 406);                    }         } else {             if ( $DataAtual = $DataAtualFormatada){                 $insere = mysqli_query($mysqli, "call EditaRegContdiario('$TipoEquip19','$local19','$Contador19','$id19')");               } else {                        header("HTTP/1.0 406 Not Found");                        header('HTTP', true, 406);               }             }}  if ($Action == 1.10) {       if($Contador19 <= $limiteDicao){           $insere = mysqli_query($mysqli, "call EditaRegContdiario('$TipoEquip19','$local19','$Contador19','$id19')");       } else{           header("HTTP/1.0 406 Not Found");           header('HTTP', true, 406);       }}mysqli_close($mysqli);?>